
FROM node:22-alpine

WORKDIR /app

# Copy root workspace files
COPY package.json package-lock.json* ./

# Copy all workspace package.json files for dependency resolution
COPY packages/game-ws-protocol/package.json ./packages/game-ws-protocol/
COPY services/game-service/package.json ./services/game-service/
COPY services/frontend-service/package.json ./services/frontend-service/

# Install all dependencies via workspace
RUN npm install

# Copy and build game-ws-protocol
COPY packages/game-ws-protocol ./packages/game-ws-protocol
RUN npm run -w @ft/game-ws-protocol build

# Copy game-service source
COPY services/game-service ./services/game-service

WORKDIR /app/services/game-service

CMD ["npm", "run", "dev"]
