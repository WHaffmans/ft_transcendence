
FROM node:20-alpine

WORKDIR /app

# Copy and build game-ws-protocol package
COPY --from=game-ws-protocol / /app/packages/game-ws-protocol
WORKDIR /app/packages/game-ws-protocol
RUN if [ -f package-lock.json ]; then npm ci; else npm install; fi && npm run build

# Setup game-service
WORKDIR /app/services/game-service
COPY package*.json ./
RUN npm install

# Copy source code
COPY . .


CMD ["npm", "run", "dev"]
