http:
  routers:
    frontend-service:
      rule: "PathPrefix(`/`)"
      service: frontend-service
      priority: 1
      entryPoints:
        - web
        - websecure

    auth-service:
      rule: "PathPrefix(`/auth`)"
      service: backend-service
      priority: 10
      entryPoints:
        - web
        - websecure
      middlewares:
        - backend-service-strip

    svelte-kit-api:
      rule: "PathPrefix(`/api`)"
      service: frontend-service
      priority: 10
      entryPoints:
        - web
        - websecure

    game-ws-web:
      rule: "PathPrefix(`/ws`)"
      service: game-service
      priority: 50
      entryPoints: [web]
      middlewares:
        - ws-headers

    game-ws-websecure:
      rule: "PathPrefix(`/ws`)"
      service: game-service
      priority: 50
      entryPoints: [websecure]
      tls: {}
      middlewares:
        - ws-headers

  services:
    frontend-service:
      loadBalancer:
        servers:
          - url: "http://frontend-service:5173"

    backend-service:
      loadBalancer:
        servers:
          - url: "http://backend-service:4000"

    game-service:
      loadBalancer:
        servers:
          - url: "http://game-service:3003"

  middlewares:
    backend-service-strip:
      stripPrefix:
        prefixes:
          - "/auth"

    ws-headers:
      headers:
        customRequestHeaders:
          Connection: "Upgrade"
          Upgrade: "websocket"

    auth-forward:
      forwardAuth:
        address: "http://backend-service:4000/api/verify"
        trustForwardHeader: true
        authResponseHeaders:
          - "X-User-Id"
