#!/usr/bin/env sh

# Configure Git merge driver for encrypted .env files
git config merge.env-encrypted.name "Merge driver for encrypted .env files"
git config merge.env-encrypted.driver "bash scripts/merge-env-encrypted.sh %O %A %B %L %P"

# Arguments: previous_head new_head branch_checkout_flag
# Flag is 1 for branch checkout, 0 for file checkout
CHECKOUT_TYPE=$3

# Only decrypt on actual branch switches, not during commits
if [ "$CHECKOUT_TYPE" = "1" ]; then
    # Auto-decrypt .env files after checkout (if key exists)
    if [ -f ".env.key" ]; then
        echo "üîì Decrypting .env files for this branch..."
        bash scripts/decrypt-env.sh
    else
        echo "‚ö†Ô∏è  .env.key not found - skipping decryption"
    fi
fi
